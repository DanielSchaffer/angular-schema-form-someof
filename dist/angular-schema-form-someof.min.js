!function(e,r){"function"==typeof define&&define.amd?define(["lodash","angular-schema-form","angular-schema-form-bootstrap"],r):"object"==typeof exports?module.exports=r(require("lodash"),require("angular-schema-form"),require("angular-schema-form-bootstrap")):e.schemaFormSomeOf=r(e._,e.angularSchemaForm,e.schemaFormBootstrap)}(this,function(e,r,o){angular.module("schemaForm").run(["$templateCache",function(e){e.put("decorators/bootstrap/someof-selector.html",'<div ng-class="{\'has-error\': form.disableErrorState !== true &amp;&amp; hasError(), \'has-success\': form.disableSuccessState !== true &amp;&amp; hasSuccess(), \'has-feedback\': form.feedback !== false}" class="form-group {{form.htmlClass}} schema-form-select"><label ng-show="showTitle()" class="control-label {{form.labelHtmlClass}}">{{form.title}}</label><select name="{{form.key.slice(-1)[0]}}" ng-model="form.selector.current" ng-disabled="form.readonly" sf-some-of-selector="sf-some-of-selector" ng-options="item.value as item.name group by item.group for item in form.titleMap" class="form-control {{form.fieldHtmlClass}}"></select><div sf-message="form.description" class="help-block"></div></div>'),e.put("decorators/bootstrap/someof.html",'<fieldset ng-disabled="form.readonly" sf-some-of="$$value$$" sf-field-model="sf-some-of" class="schema-form-fieldset {{form.htmlClass}} schema-form-someof"><legend ng-class="{\'sr-only\': !showTitle() }">{{ form.title }}</legend><div ng-show="form.description" ng-bind-html="form.description" class="help-block"></div></fieldset>')}]);var t;return angular.module("schemaForm").config(["schemaFormDecoratorsProvider","schemaFormProvider","sfBuilderProvider","sfPathProvider","someOfProvider",function(r,o,t,s,n){function a(r,t,s){var n=o.defaultFormDefinition(r,e.extend({},t,{type:"object"}),s);return n.type="someof-fieldset",n.key=s.path.slice(),n.carryover={},n}function i(r,t,n){if(!t[t.type]||!c[t.type])return null;var a=n.path.slice();a.push("selected");var i=o.stdFormObj(r,t,n);return i.key=a,i.type=c[t.type]+"-selector",i.titleMap=e.chain(t[t.type]).map(function(e){return[e.title||e.name,e.title||e.name]}).object().value(),i.selector=i,i.forms=[],n.lookup[s.stringify(a)]=i,i}function l(r,t,s){var a=e.first(e.intersection(e.keys(c),e.keys(t)));if(!a)return null;var i=o.defaultFormDefinition(r,e.extend(e.omit(t,a),{type:"someOfFieldset"}),s);if(!i)return null;var l=n.someOfDifferentiatorProperty(),m=l&&t[l];if(!m){var u=o.defaultFormDefinition(a,e.extend(e.pick(t,a,"title","name"),{type:a}),s);if(!u)return null;i.selector=u,i.items.push(u)}return angular.forEach(t[a],function(r){var n=o.defaultFormDefinition(r.title||r.name,angular.extend(r,{type:"object"}),s);if(n){if(n.selector=u,m){var a=i.key.slice();a.push(l),n.condition="model"+f(a)+" === '"+r.properties[l]["enum"][0]+"'",n.items&&(n.items=e.filter(n.items,function(r){return!e.has(t.properties,r.title)}),e.each(n.items,function(e){e.destroyStrategy="carry",e.carryover=i.carryover}))}else n.condition="form.selector.current === '"+(r.title||r.name)+"'",u.forms.push(n);i.items.push(n)}}),i}function f(r){return e.map(r,function(e){return""!==e?"['"+e+"']":"[arrayIndex]"}).join("")}function m(e){"carry"===e.form.destroyStrategy&&e.fieldFrag.firstChild.setAttribute("sf-carryover","")}var c={oneOf:"oneof",anyOf:"anyof",allOf:"allof"},u=t.builders.simpleTransclusion,d=t.builders.ngModelOptions,p=t.builders.ngModel,y=t.builders.sfField,h=t.builders.condition;t.builders.array;o.prependRule("object",l),o.prependRule("someOfFieldset",a),r.defineAddOn("bootstrapDecorator","someof-fieldset","decorators/bootstrap/someof.html",[y,p,d,u]),e.each(c,function(e,t){o.prependRule(t,i),r.defineAddOn("bootstrapDecorator",e+"-selector","decorators/bootstrap/someof-selector.html",[y,p,d,h])});var v=r.decorator();e.each(v,function(e){e.builder&&e.builder.push(m)})}]),angular.module("schemaForm").provider("someOf",function(){var e;this.someOfDifferentiatorProperty=function(r){return"undefined"!=typeof r&&(e=r),e},this.$get=[function(){return{}}]}),angular.module("schemaForm").directive("sfCarryover",["sfSelect",function(r){return{scope:!1,priority:100,link:{pre:function(o,t,s){o.$on("schemaFormPropagateNgModelController",function(e,r,t){if(o.form.carryover){var n=o.form.key[o.form.key.length-1];if(n&&"undefined"!=typeof o.form.carryover[n]){var a=(s.sfNewArray||t)+"=carryoverValue";o.$eval(a,{carryoverValue:o.form.carryover[n]})}}}),o.$on("$destroy",function(){var t=o.form;if(!o.externalDestructionInProgress){var s=t.destroyStrategy||o.options&&o.options.destroyStrategy||"remove";if(t.key&&"carry"===s){var n=o.model;if(t.key.length>1){var a=e.map(t.key.slice(0,t.key.length-1),function(e){return""===e?o.$index:e});n=r(a,n)}if("undefined"==typeof n)return;var i=t.key.slice(-1);t.carryover[i]=n[i],delete n[i]}}})}}}}]),angular.module("schemaForm").directive("sfSomeOf",function(){return{scope:!0,controller:["$attrs","$parse","$scope",function(e,r,o){var t=r(e.sfSomeOf);return{getModel:function(){return t(o)},getKey:function(){return o.form.key}}}]}}),angular.module("schemaForm").directive("sfSomeOfSelector",["sfValidator",function(r){return{require:["^sf-some-of","ngModel"],scope:!1,link:function(o,t,s,n){var a=n[0],i=n[1],l=a.getModel(),f=e.find(o.form.forms,function(o){var t=e.extend({key:a.getKey()},o);return r.validate(t,l).valid});f&&(i.$setViewValue(f.title||f.name),i.$setPristine(),i.$setUntouched())}}}]),t});